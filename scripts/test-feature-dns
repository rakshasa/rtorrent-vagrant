#!/usr/bin/env bash
#
# Compile with each of the different async dns resolvers, do make
# check and ci test default/bind/dns.
#
# Improve test naming in the results.

source "$(dirname ${BASH_SOURCE[0]})/include/test_unit"

test_dns() {
  test_unit "default"
  test_unit "dns_default"
}

test_init "test-feature-dns"

# make feature test proper test

test_begin "Without UDNS"
test_compile "WITHOUT_UDNS=yes"
"${SCRIPT_DIR}/build-has-feature" without-udns
test_dns

test_begin "With UDNS"
test_compile "SKIP_RTORRENT=yes WITHOUT_UDNS=no"
"${SCRIPT_DIR}/build-has-feature" with-udns
test_dns

test_cleanup
